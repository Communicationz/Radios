<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Folk Fest Radio Inventory System</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background-color: #f0f4f8;
            color: #333;
            line-height: 1.6;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            background: white;
            color: #2a5298;
            padding: 0.5rem 0;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            margin-bottom: 2rem;
            border-bottom: 2px solid #2a5298;
        }

        .header-content {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 1rem;
        }

        .header-left {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .logout-btn {
            background: #ff6b6b;
            color: white;
            padding: 0.5rem 1rem;
            font-size: 0.9rem;
        }

        .logout-btn:hover {
            background: #ff5252;
        }

        .logo {
            width: 40px;
            height: 40px;
        }

        h1 {
            font-size: 1.25rem;
            font-weight: 600;
        }

        .login-container {
            max-width: 400px;
            margin: 100px auto;
            background: white;
            padding: 2rem;
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        .main-content {
            display: none;
        }

        .form-section {
            background: white;
            padding: 2rem;
            border-radius: 12px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            margin-bottom: 2rem;
        }

        .form-grid {
            display: grid;
            gap: 1rem;
            margin-bottom: 1rem;
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        label {
            font-weight: 600;
            margin-bottom: 0.5rem;
            color: #2a5298;
        }

        input, select {
            padding: 0.75rem;
            border: 2px solid #e1e8ed;
            border-radius: 8px;
            font-size: 1rem;
            transition: all 0.3s ease;
        }

        input:focus, select:focus {
            outline: none;
            border-color: #2a5298;
            box-shadow: 0 0 0 3px rgba(42, 82, 152, 0.1);
        }

        button {
            background: #2a5298;
            color: white;
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        button:hover {
            background: #1e3c72;
            transform: translateY(-1px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }

        button:active {
            transform: translateY(0);
        }

        .scanner-btn {
            background: #87ceeb;
            color: #1e3c72;
            margin-left: 0.5rem;
        }

        .scanner-btn:hover {
            background: #5f9ea0;
            color: white;
        }

        .controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
            flex-wrap: wrap;
            gap: 1rem;
        }

        .view-selector {
            display: flex;
            gap: 1rem;
            align-items: center;
        }

        .action-buttons {
            display: flex;
            gap: 0.5rem;
        }

        .equipment-list {
            background: white;
            border-radius: 12px;
            padding: 1rem;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .search-box {
            width: 300px;
            padding: 0.75rem;
            border: 2px solid #e1e8ed;
            border-radius: 8px;
            margin-bottom: 1rem;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        th, td {
            padding: 1rem;
            text-align: left;
            border-bottom: 1px solid #e1e8ed;
        }

        th {
            background: #f8f9fa;
            font-weight: 600;
            color: #2a5298;
            position: sticky;
            top: 0;
        }

        tr:hover {
            background: #f8f9fa;
        }

        .status-badge {
            padding: 0.25rem 0.75rem;
            border-radius: 999px;
            font-size: 0.875rem;
            font-weight: 600;
        }

        .status-issued {
            background: #ffeaa7;
            color: #d68910;
        }

        .status-returned {
            background: #55efc4;
            color: #00b894;
        }

        .return-btn {
            background: #00b894;
            padding: 0.5rem 1rem;
            font-size: 0.875rem;
        }

        .return-btn:hover {
            background: #00a087;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background: white;
            padding: 2rem;
            border-radius: 12px;
            max-width: 500px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
        }

        .close-modal {
            float: right;
            font-size: 1.5rem;
            cursor: pointer;
            color: #666;
        }

        .close-modal:hover {
            color: #333;
        }

        #scanner-container {
            width: 100%;
            max-width: 400px;
            margin: 1rem auto;
            position: relative;
        }

        #interactive {
            position: relative;
            width: 100%;
            height: 300px;
            max-width: 400px;
            margin: 0 auto;
        }

        #interactive.viewport {
            position: relative;
        }

        #interactive.viewport canvas,
        #interactive.viewport video {
            width: 100%;
            height: auto;
            position: absolute;
            top: 0;
            left: 0;
        }

        #interactive.viewport canvas.drawingBuffer {
            position: absolute;
            top: 0;
            left: 0;
        }

        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .stat-card {
            background: white;
            padding: 1.5rem;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            text-align: center;
        }

        .stat-number {
            font-size: 2rem;
            font-weight: 700;
            color: #2a5298;
        }

        .stat-label {
            color: #666;
            font-size: 0.875rem;
        }

        @media (max-width: 768px) {
            .controls {
                flex-direction: column;
                align-items: stretch;
            }

            .search-box {
                width: 100%;
            }

            .action-buttons {
                justify-content: center;
            }

            table {
                font-size: 0.875rem;
            }

            th, td {
                padding: 0.5rem;
            }
        }

        .error-message {
            background: #ff6b6b;
            color: white;
            padding: 1rem;
            border-radius: 8px;
            margin-bottom: 1rem;
            display: none;
        }

        .success-message {
            background: #00b894;
            color: white;
            padding: 1rem;
            border-radius: 8px;
            margin-bottom: 1rem;
            display: none;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .fade-in {
            animation: fadeIn 0.3s ease-out;
        }
    </style>
</head>
<body>
    <header>
        <div class="container">
            <div class="header-content">
                <div class="header-left">
                    <svg class="logo" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg">
                        <circle cx="512" cy="512" r="480" fill="none" stroke="#0033FF" stroke-width="64"/>
                        <circle cx="512" cy="512" r="416" fill="#0033FF"/>
                        <path d="M 320 250 Q 320 200 370 200 L 654 200 Q 704 200 704 250 L 704 774 Q 704 824 654 824 L 370 824 Q 320 824 320 774 Z" fill="white"/>
                        <rect x="370" y="250" width="284" height="524" rx="25" fill="#0033FF"/>
                        <rect x="400" y="300" width="224" height="120" fill="white"/>
                        <rect x="400" y="440" width="224" height="40" fill="white"/>
                        <circle cx="512" cy="600" r="120" fill="none" stroke="white" stroke-width="20"/>
                        <circle cx="512" cy="500" r="15" fill="white"/>
                        <circle cx="582" cy="520" r="15" fill="white"/>
                        <circle cx="612" cy="570" r="15" fill="white"/>
                        <circle cx="612" cy="630" r="15" fill="white"/>
                        <circle cx="582" cy="680" r="15" fill="white"/>
                        <circle cx="512" cy="700" r="15" fill="white"/>
                        <circle cx="442" cy="680" r="15" fill="white"/>
                        <circle cx="412" cy="630" r="15" fill="white"/>
                        <circle cx="412" cy="570" r="15" fill="white"/>
                        <circle cx="442" cy="520" r="15" fill="white"/>
                        <text x="512" y="620" text-anchor="middle" font-family="Arial" font-size="60" font-weight="bold" fill="white">Z</text>
                        <text x="512" y="900" text-anchor="middle" font-family="Arial" font-size="100" font-weight="bold" fill="white">PFFCO</text>
                    </svg>
                    <h1>Folk Fest Radio Inventory System</h1>
                </div>
                <button class="logout-btn" onclick="x9()" style="display: none;" id="logoutBtn">Logout</button>
            </div>
        </div>
    </header>

    <div id="loginScreen" class="container">
        <div class="login-container">
            <h2 style="text-align: center; margin-bottom: 2rem; color: #2a5298;">System Login</h2>
            <div class="form-group">
                <label for="loginCode">Access Code</label>
                <input type="text" id="loginCode" placeholder="Enter access code">
            </div>
            <div class="form-group" style="margin-top: 1rem;">
                <label for="loginPassword">Password</label>
                <input type="password" id="loginPassword" placeholder="Enter password">
            </div>
            <button onclick="a1()" style="width: 100%; margin-top: 1.5rem;">Login</button>
            <div id="loginError" class="error-message" style="margin-top: 1rem;"></div>
        </div>
    </div>

    <div id="mainApp" class="container main-content">
        <div class="error-message" id="errorMessage"></div>
        <div class="success-message" id="successMessage"></div>

        <div class="form-section fade-in">
            <h2 style="margin-bottom: 1.5rem; color: #2a5298;">Issue Equipment</h2>
            <div class="form-grid">
                <div class="form-group">
                    <label for="equipmentId">Equipment ID</label>
                    <div style="display: flex;">
                        <input type="text" id="equipmentId" placeholder="Enter or scan ID" required>
                        <button class="scanner-btn" onclick="s1()">📷 Scan</button>
                    </div>
                </div>
                <div class="form-group">
                    <label for="committee">Committee</label>
                    <select id="committee" required>
                        <option value="">Select Committee</option>
                        <option value="Production">Production</option>
                        <option value="Tramcart">Tramcart</option>
                        <option value="Communicationz">Communicationz</option>
                        <option value="Groundz">Groundz</option>
                        <option value="PFFLE">PFFLE</option>
                        <option value="Safety">Safety</option>
                        <option value="Camping">Camping</option>
                        <option value="Security">Security</option>
                        <option value="Craftz">Craftz</option>
                        <option value="Parking">Parking</option>
                        <option value="Admin">Admin</option>
                        <option value="Gate">Gate</option>
                        <option value="Hospitality">Hospitality</option>
                        <option value="Medical">Medical</option>
                        <option value="Vendors">Vendors</option>
                        <option value="Volunteers">Volunteers</option>
                        <option value="Stage Management">Stage Management</option>
                        <option value="Sound">Sound</option>
                        <option value="Lighting">Lighting</option>
                        <option value="Site Ops">Site Ops</option>
                        <option value="Transportation">Transportation</option>
                        <option value="Waste Management">Waste Management</option>
                        <option value="Info Booth">Info Booth</option>
                        <option value="Kids Area">Kids Area</option>
                        <option value="Green Team">Green Team</option>
                        <option value="Accessibility">Accessibility</option>
                        <option value="Media">Media</option>
                        <option value="Artist Liaison">Artist Liaison</option>
                        <option value="Box Office">Box Office</option>
                        <option value="Merchandise">Merchandise</option>
                        <option value="Other">Other</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="individual">Individual Name</label>
                    <input type="text" id="individual" placeholder="Enter name" required>
                </div>
                <div class="form-group">
                    <label for="phone">Phone Number (Optional)</label>
                    <input type="tel" id="phone" placeholder="Enter phone number">
                </div>
            </div>
            <button onclick="e1()" style="width: 100%;">Issue Equipment</button>
        </div>

        <div class="controls">
            <div class="view-selector">
                <label for="viewSelect">View:</label>
                <select id="viewSelect" onchange="v1()">
                    <option value="all">All Equipment</option>
                    <option value="missing">Missing Equipment</option>
                    <option value="history">Full History</option>
                </select>
            </div>
            <div class="action-buttons">
                <button onclick="p1()">Export CSV</button>
                <button onclick="p2()">Print Report</button>
                <button onclick="r1()" style="background: #ff6b6b;">Reset System</button>
            </div>
        </div>

        <div class="stats" id="stats">
            <div class="stat-card">
                <div class="stat-number" id="totalEquipment">0</div>
                <div class="stat-label">Total Equipment</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="issuedEquipment">0</div>
                <div class="stat-label">Currently Issued</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="returnedEquipment">0</div>
                <div class="stat-label">Returned</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="missingEquipment">0</div>
                <div class="stat-label">Missing</div>
            </div>
        </div>

        <div class="equipment-list">
            <input type="text" class="search-box" id="searchBox" placeholder="Search by ID, name, or committee..." onkeyup="f1()">
            <div style="overflow-x: auto;">
                <table>
                    <thead>
                        <tr>
                            <th>Equipment ID</th>
                            <th>Committee</th>
                            <th>Individual</th>
                            <th>Phone</th>
                            <th>Status</th>
                            <th>Issued At</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="equipmentTableBody">
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <div id="scannerModal" class="modal">
        <div class="modal-content">
            <span class="close-modal" onclick="s2()">&times;</span>
            <h3 style="margin-bottom: 1rem;">Scan Equipment Barcode</h3>
            <div id="scanner-container">
                <div id="reader" style="width: 100%; max-width: 400px; margin: 0 auto;"></div>
                <div id="scanner-result" style="margin-top: 1rem; text-align: center; font-weight: bold; color: #2a5298;"></div>
            </div>
            <p style="text-align: center; margin-top: 1rem; color: #666;">Position the barcode within the camera view</p>
            <div style="text-align: center; margin-top: 1rem;">
                <button onclick="s3()" style="background: #87ceeb; color: #1e3c72; margin-right: 0.5rem;">Simulate Scan (Demo)</button>
                <button onclick="s4()" style="background: #95a5a6; color: white;">Manual Entry</button>
            </div>
        </div>
    </div>

    <div id="resetModal" class="modal">
        <div class="modal-content">
            <span class="close-modal" onclick="r2()">&times;</span>
            <h3 style="margin-bottom: 1rem; color: #ff6b6b;">Reset System</h3>
            <p style="margin-bottom: 1rem;">This will clear all equipment records. A backup will be automatically created.</p>
            <div class="form-group">
                <label for="resetPassword">Enter Password</label>
                <input type="password" id="resetPassword" placeholder="Enter reset password">
            </div>
            <button onclick="r3()" style="background: #ff6b6b; width: 100%; margin-top: 1rem;">Confirm Reset</button>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
    <script src="https://unpkg.com/html5-qrcode"></script>
    <script>
        const k = []; // equipment array
        let cv = 'all'; // currentView
        let lg = false; // isLoggedIn
        let cr = null; // codeReader
        let sd = null; // selectedDeviceId
        let ls = true; // useLocalStorage

        // Obfuscated configuration
        const cfg = {
            h1: 'NjljNzM3YjE1MjM5ZjE1NTUxNTQzNjM2YzIxNjAzZjQzMGQzZWJhNGVhZDI3NDkwYmUyYjU2ZGVhNWYyZmU1Mw==', // PFFCO hash
            h2: 'OTBjNDM2ZGU3Mjg1NjE5Y2ZhNGY3NzM5MTgyMzMzOTcxMGY5MDdiODBjNWZmMzY1MDFkZGJjNzU4NDZmZjkyMw==', // 2583 hash
            h3: 'OTBjNDM2ZGU3Mjg1NjE5Y2ZhNGY3NzM5MTgyMzMzOTcxMGY5MDdiODBjNWZmMzY1MDFkZGJjNzU4NDZmZjkyMw==', // reset hash
            s: 'RmFsa0ZlUzJjRAQ0UmFkaWe*', // salt (base64)
            ma: 5, // maxAttempts
            ld: 300000, // lockoutDuration
            at: 0, // attempts
            lu: null, // lockedUntil
            sd: 8 * 60 * 60 * 1000, // sessionDuration
            st: null // sessionToken
        };

        // String obfuscation helper
        const ds = (arr) => String.fromCharCode(...arr); // decodeString

        // Obfuscated strings
        const str = {
            ie: [73,110,118,97,108,105,100,32,99,114,101,100,101,110,116,105,97,108,115], // Invalid credentials
            sm: [76,111,103,105,110,32,115,117,99,99,101,115,115,102,117,108], // Login successful
            af: [80,108,101,97,115,101,32,102,105,108,108,32,105,110,32,97,108,108,32,114,101,113,117,105,114,101,100,32,102,105,101,108,100,115], // Please fill in all required fields
            ae: [69,113,117,105,112,109,101,110,116,32,105,115,32,97,108,114,101,97,100,121,32,105,115,115,117,101,100], // Equipment is already issued
            es: [69,113,117,105,112,109,101,110,116,32,105,115,115,117,101,100,32,115,117,99,99,101,115,115,102,117,108,108,121], // Equipment issued successfully
            rs: [69,113,117,105,112,109,101,110,116,32,114,101,116,117,114,110,101,100,32,115,117,99,99,101,115,115,102,117,108,108,121], // Equipment returned successfully
            de: [68,97,116,97,32,101,120,112,111,114,116,101,100,32,115,117,99,99,101,115,115,102,117,108,108,121], // Data exported successfully
            sr: [83,121,115,116,101,109,32,114,101,115,101,116,32,99,111,109,112,108,101,116,101], // System reset complete
            ip: [73,110,118,97,108,105,100,32,112,97,115,115,119,111,114,100], // Invalid password
            la: [84,111,111,32,109,97,110,121,32,97,116,116,101,109,112,116,115], // Too many attempts
            ss: [83,117,99,99,101,115,115,102,117,108,108,121,32,115,99,97,110,110,101,100] // Successfully scanned
        };

        // Hash function with salt
        const h = (input) => {
            const salt = atob(cfg.s);
            return btoa(CryptoJS.SHA256(input + salt).toString());
        };

        // Check localStorage availability
        try {
            localStorage.setItem('test', 'test');
            localStorage.removeItem('test');
        } catch (e) {
            ls = false;
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            ld(); // loadData
            us(); // updateStats
            rt(); // renderTable
        });

        // Authentication
        function a1() { // login
            if (cfg.lu && Date.now() < cfg.lu) {
                se(ds(str.la));
                return;
            }

            const c = document.getElementById('loginCode').value;
            const p = document.getElementById('loginPassword').value;
            
            if (h(c) === cfg.h1 && h(p) === cfg.h2) {
                document.getElementById('loginScreen').style.display = 'none';
                document.getElementById('mainApp').style.display = 'block';
                document.getElementById('logoutBtn').style.display = 'block';
                lg = true;
                cfg.st = gs(); // generateSessionToken
                cfg.at = 0;
                cfg.lu = null;
                if (ls) {
                    localStorage.setItem('ffls', cfg.st); // folkFestLoggedIn
                    localStorage.setItem('ffts', Date.now().toString()); // session timestamp
                }
                ss(ds(str.sm));
            } else {
                cfg.at++;
                if (cfg.at >= cfg.ma) {
                    cfg.lu = Date.now() + cfg.ld;
                }
                const error = document.getElementById('loginError');
                error.textContent = ds(str.ie);
                error.style.display = 'block';
            }
        }

        // Generate session token
        function gs() {
            return btoa(Date.now() + Math.random().toString(36));
        }

        // Check session validity
        function cs() { // checkSession
            if (!ls) return lg;
            const token = localStorage.getItem('ffls');
            const timestamp = localStorage.getItem('ffts');
            if (token && timestamp) {
                const sessionAge = Date.now() - parseInt(timestamp);
                if (sessionAge < cfg.sd) {
                    return true;
                }
            }
            return false;
        }

        // Check login status on load
        if (cs()) {
            document.getElementById('loginScreen').style.display = 'none';
            document.getElementById('mainApp').style.display = 'block';
            document.getElementById('logoutBtn').style.display = 'block';
            lg = true;
        }

        // Data management
        function ld() { // loadData
            if (ls) {
                const stored = localStorage.getItem('ffe'); // folkFestEquipment
                if (stored) {
                    k.length = 0;
                    k.push(...JSON.parse(stored));
                }
            }
        }

        function sd() { // saveData
            if (ls) {
                localStorage.setItem('ffe', JSON.stringify(k));
            }
        }

        // Equipment operations
        function e1() { // issueEquipment
            const id = document.getElementById('equipmentId').value.trim();
            const committee = document.getElementById('committee').value;
            const individual = document.getElementById('individual').value.trim();
            const phone = document.getElementById('phone').value.trim();

            if (!id || !committee || !individual) {
                se(ds(str.af));
                return;
            }

            const ex = k.find(e => e.id === id && e.status === 'Issued');
            if (ex) {
                se(ds(str.ae));
                return;
            }

            const nr = {
                id,
                committee,
                individual,
                phone,
                status: 'Issued',
                timestamp: new Date().toISOString(),
                returnedAt: null
            };

            k.push(nr);
            sd();
            us();
            rt();
            cf(); // clearForm
            ss(ds(str.es));
        }

        function e2(id) { // returnEquipment
            const item = k.find(e => e.id === id && e.status === 'Issued');
            if (item) {
                item.status = 'Returned';
                item.returnedAt = new Date().toISOString();
                sd();
                us();
                rt();
                ss(ds(str.rs));
            }
        }

        function cf() { // clearForm
            document.getElementById('equipmentId').value = '';
            document.getElementById('committee').value = '';
            document.getElementById('individual').value = '';
            document.getElementById('phone').value = '';
        }

        // Statistics and rendering
        function us() { // updateStats
            const total = k.length;
            const issued = k.filter(e => e.status === 'Issued').length;
            const returned = k.filter(e => e.status === 'Returned').length;

            document.getElementById('totalEquipment').textContent = total;
            document.